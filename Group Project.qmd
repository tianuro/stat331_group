---
title: "Analysis of Income and Market Value"
author: "Eric, Visruth, Sebastian, Ryan"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
    number-sections: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---


We're looking at the relationship between income and market value of listed companies.

# Data Cleaning

## Dataset A:
market_value_of_listed_companies_percent_of_gdp.csv

### Description:
This dataset contains information on the market value of listed companies as a percentage of GDP for various countries over a range of years.

### Variables:
**country:** Name of the country.
**year:** Year of the data point.
**market_value:** Market value of listed companies as a percentage of GDP.

## Dataset B:
mincpcap_cppp.csv

### Description:
This dataset includes data on the mean income per capita (PPP) for various countries over a range of years.

### Variables:
**country:** Name of the country.
**year:** Year of the data point.
**income:** Mean income per capita (PPP).

Combined Dataset
Description: The merged dataset includes both the market value of listed companies as a percentage of GDP and the mean income per capita (PPP) for each country-year combination.

Hypothesized Relationship Between the Variables
We hypothesize that there is a positive relationship between mean income per capita (PPP) and the market value of listed companies as a percentage of GDP. Higher income per capita might indicate a wealthier population and stronger economic performance, which could lead to higher valuations of publicly listed companies. Thus, we expect to see that as the income per capita increases, the market value of listed companies as a percentage of GDP also increases.

Loading Data:

The two datasets were loaded into R using the read_csv function from the tidyverse package.

Datasets
market_value_of_listed_companies_percent_of_gdp.csv

Description: This dataset contains information on the market value of listed companies as a percentage of GDP for various countries over a range of years.

Variables:
country: Name of the country.
year: Year of the data point.
market_value: Market value of listed companies as a percentage of GDP.

mincpcap_cppp.csv

Description: This dataset includes data on the mean income per capita (PPP) for various countries over a range of years.

Variables:
country: Name of the country.
year: Year of the data point.
income: Mean income per capita (PPP).

Combined Dataset
Description: The merged dataset includes both the market value of listed companies as a percentage of GDP and the mean income per capita (PPP) for each country-year combination.

Hypothesized Relationship Between the Variables
We hypothesize that there is a positive relationship between mean income per capita (PPP) and the market value of listed companies as a percentage of GDP. Higher income per capita might indicate a wealthier population and stronger economic performance, which could lead to higher valuations of publicly listed companies. Thus, we expect to see that as the income per capita increases, the market value of listed companies as a percentage of GDP also increases.

Loading Data:

The two datasets were loaded into R using the read_csv function from the tidyverse package.

```{r setup}
library(tidyverse)
market <- read_csv("market_value_of_listed_companies_percent_of_gdp.csv")
income <- read_csv("mincpcap_cppp.csv")
```

Reshaping / Merging Data:

Both datasets were reshaped from wide format to long format using the pivot_longer function. This was necessary to facilitate the merging of the datasets and subsequent analysis. The two datasets were merged on the country and year columns using the inner_join function. This ensures that only country-year combinations present in both datasets are included in the final dataset.

```{r}
market <- market |>
  pivot_longer(cols = -country, names_to = "year", values_to = "market_value")

income <- income |>
  pivot_longer(cols = -country, names_to = "year", values_to = "income") 

data <- market |>
  inner_join(income, by = c("country", "year")) |>
  drop_na() # removing years which don't have both market value and income data
```

By completing these steps, we were able to create a clean dataset for data analysis and hypothesis testing. With accurate and complete data, we can improve the reliability of our findings.

# Linear Regression
## Data Visualization
```{r, df with mean values of market and income per yr}
data_means <- data |>
  group_by(year) |> # grouping by yr
  summarize(
    mean_market_value = mean(market_value),
    sem_market_value = sd(market_value) / sqrt(n()),
    mean_income = mean(income),
    sem_income = sd(income)/sqrt(n()),
    .groups = 'drop'
)
```

Notes: 
- Describe what the explanatory variable(independent) and response variable(dependent) is (rewrite the first section to reflect this)

- First visualization will be a scatterplot with geom_smooth. Talk about the relationship (W9 in-class slides)

- 

```{r, visuals}
library(ggplot2)

```
## Linear Regression Model
```{r, linear regression model}
model <- lm(mean_market_value ~ mean_income, data = data_means)

summary(model)

```

$\text{Market Value (% of GDP)} = \hat{\beta}_0 + \hat{\beta}_1 \times \text{Daily Income per Capita} + \epsilon$

## Model Fit


=======

By completing these steps, we were able to create a clean dataset for data analysis and hypothesis testing. With accurate and complete data, we can improve the reliability of our findings.
